<% is_admin = @user.try(:is_admin?) %>
<div class="box wide">
  <div class="legend">Tags</div>

  <p>Inactive tags can no longer be used. You can also <a href="/filters">filter out stories by tag</a>.</p>

  <% @categories.each do |category| %>
    <h2><%= link_to category.category, category_path(category) %></h2>

    <ol class="category_tags">
      <% if is_admin %>
        <li>
          <%= link_to 'Edit', edit_category_path(category.category) %> this category.
        </li>
      <% end %>
      <% category.tags.each do |tag| %>
        <li>
        <% filtered = @filtered_tags.include?(tag.id) %>
        <%= link_to tag.tag, tag_path(tag), class: tag.css_class %>
        <span class="<%= filtered || !tag.active ? 'inactive_tag' : '' %>"><%= tag.description %></span>
        <span class="byline">
        <% if !tag.active %>
          | <em>inactive</em>
        <% end %>
        <% if filtered %>
          | <%= link_to "filtered", filters_path(anchor: tag.tag) %>
        <% end %>
        <% if is_admin %>
          | <%= link_to 'edit', edit_tag_path(tag.tag) %>
        <% end %>
        </span>
        </li>
      <% end %>
    </ol>
  <% end %>

  <% if is_admin %>
    <div>
      <%= link_to 'Create New Tag', new_tag_path %>
    </div>
    <div>
      <%= link_to 'Create New Category', new_category_path %>
    </div>
  <% end %>
</div>
